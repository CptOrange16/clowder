@(myForm: Form[ProjectSpace])(implicit flash: play.api.mvc.Flash, user: Option[securesocial.core.Identity])

@import helper._
@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.f) }

@main("Space") {
    <div class="page-header">
        <h1>Add New Space</h1>
    </div>
    <div class="row">
        <div class="col-md-12">
            @if(myForm.hasErrors) {
                <div class="alert alert-error">
                    <p>Please fix all errors</p>
                </div>
            }
            @flash.get("error").map { message =>
                <div class="alert alert-error">
                    <p>@message</p>
                </div>
            }

            @form(action = routes.Spaces.submit, 'enctype -> "multipart/form-data", 'class -> "form-horizontal") {
                <fieldset  id="nameDescrFieldSet">
                    @inputText(myForm("name"), '_label -> "Name")
                    @textarea(myForm("description"), '_label -> "Description")
                    <div class = "homePages">
                        @repeat(myForm("homePages"), min = 1) {pageMap =>
                            @inputText(pageMap("homePage"), '_label -> "Home Page")
                            }
                        <div class="home-page-add"><a href="#">add</a></div>
                    </div>
                    @inputText(myForm("logoUrl"), '_label-> "Logo URL")
                    @inputText(myForm("bannerUrl"), '_label-> "Banner URL")
                </fieldset>
                <div class="form-actions">
                    <input type="submit" class="btn btn-default" value="Create"/>
                </div>
            }
        </div>
    </div>
    <script language="javascript">
    var renumberDataMap = function() {
    Array.prototype.reduce.call($('.homePages .control-group'), function (i, next) {
    var label = $(next).children('label');
    label.attr('for', label.attr('for').replace(/_\d+__/, '_' + i + '__'));

    var input = $(next).find('input');
    input.attr('id', input.attr('id').replace(/_\d+__/, '_' + i + '__'));
    input.attr('name', input.attr('name').replace(/\[\d+\]/, '[' + i + ']'));

    if (input.attr('id').match(/homePages_\d+__homePage/)) {
    return i + 1;
    }

    return i;
    }, 0);
    }

    $('.homePages').on('click', '.home-page-delete a', function () {
    $(this).parent().next().remove();
    $(this).parent().remove();

    renumberDataMap();
    });

    $('.home-page-add').click(function () {
    var value = $(this).prev().clone();

    $(this).prev().after($('<div class="home-page-delete"><a href="#">delete</a></div>'));
    value.find('input').val('');
    $(this).before(value);
    renumberDataMap();
    });
    </script>
}