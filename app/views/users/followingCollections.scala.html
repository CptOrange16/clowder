@(collections: List[models.Collection], prev: Int, next: Int, limit: Int, mode: Option[String], space: Option[String], title: Option[String], owner:Option[String])(implicit flash: play.api.mvc.Flash, user: Option[models.User])

@import _root_.util.Formatters.ellipsize

@main("Collections") {

    @util.masonry()

    <script src="@routes.Assets.at("javascripts/collectionListProcess.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/jquery.cookie.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/follow-button.js")" type="text/javascript"></script>
    <div class="row">
        <div class="col-md-12">
            <h1>@title</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-md-10">
        </div>
        <div class="col-md-1">
        @if(user.isDefined) {
            <a id="create-collection" class="btn btn-primary btn-sm pull-right" href="@routes.Collections.newCollection(space)" title="Create a new collection"> <span class="glyphicon glyphicon-ok"></span> Create</a>
        }

        </div>
        <div class="col-md-1">
            <div class="btn-group btn-group-sm pull-right">
                <button type="button" class="btn btn-default active" href="#tile-view" id="tile-view-btn"><span class="glyphicon glyphicon-th-large"></span></button>
                <button type="button" class="btn btn-default" href="#list-view" id="list-view-btn"><span class="glyphicon glyphicon-th-list"></span></button>
            </div>
            <script>
	        var viewMode = '@mode.getOrElse("tile")';
	        $.cookie.raw = true;
	        $.cookie.json = true;
            $(function() {
                $('#tile-view-btn').click(function() {
                  $('#tile-view').removeClass('hidden');
                  $('#list-view').addClass('hidden');
                  $('#tile-view-btn').addClass('active');
                  $('#list-view-btn').removeClass('active');
                  viewMode = "tile";
                  updatePage();
                  $.cookie('view-mode', 'tile', { path: '/' });
                  $('#masonry').masonry().masonry({
                      itemSelector: '.post-box',
                      columnWidth: '.post-box',
                      transitionDuration: 4
                  });
                });
                $('#list-view-btn').click(function() {
                  $('#tile-view').addClass('hidden');
                  $('#list-view').removeClass('hidden');
                  $('#list-view-btn').addClass('active');
                  $('#tile-view-btn').removeClass('active');
                  viewMode = "list";
                  updatePage();
                  //Utilizing library from https://github.com/carhartl/jquery-cookie/tree/v1.4.1
                  $.cookie("view-mode", "list", { path: '/' });
                });
            });

            $(document).ready(function() {
            	//Set the cookie, for the case when it is passed in by the parameter
                $.cookie("view-mode", viewMode, { path: '/' });
                if (viewMode == "list") {
                    $('#tile-view').addClass('hidden');
                    $('#list-view').removeClass('hidden');
                    $('#list-view-btn').addClass('active');
                    $('#tile-view-btn').removeClass('active');
                }
                else {
                    $('#tile-view').removeClass('hidden');
                    $('#list-view').addClass('hidden');
                    $('#tile-view-btn').addClass('active');
                    $('#list-view-btn').removeClass('active');
                }
                updatePage();
            });

            //Function to unify the changing of the href for the next/previous links. Called on button activation for
            //viewMode style, as well as on initial load of page.
            function updatePage() {
                $('#nextlink').attr('href', "@(routes.Collections.followingCollections("a", next, limit, ""))");
                $('#prevlink').attr('href', "@(routes.Collections.followingCollections("b", prev, limit, ""))");
            }
        </script>
        </div>
    </div>


    <div class="row hidden" id="tile-view">
        <div class="col-md-12">
            <div id="masonry">
            @collections.map { collection =>
                    @templates.collection(collection, "col-lg-3 col-md-3 col-sm-3", true)

            }
            </div>
        </div>
    </div>


    <div class="row hidden" id="list-view">
        <div class="col-md-12">
        @collections.map { collection =>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-2 col-sm-2 col-lg-2">
                            @if(!collection.thumbnail_id.isEmpty){<img src="@(routes.Files.thumbnail(UUID(collection.thumbnail_id.toString().substring(5,collection.thumbnail_id.toString().length-1))))" alt="Thumbnail of @Html(collection.name)" width="120">}
                        </div>
                        <div class="col-md-10 col-sm-10 col-lg-10">
                            <h2><a href="@(routes.Collections.collection(collection.id))">@Html(collection.name)</a></h2>
                            <div class="row">
                                <div class="col-md-6 col-lg-6 col-sm-6">
                                    <ul class="list-unstyled">
                                        <li>@Html(collection.description)</li>
                                        <li>@collection.created.format("MMM dd, yyyy")</li>
                                        <li>
                                            <span class="glyphicon glyphicon glyphicon-file" title="@collection.datasetCount datasets"></span> @collection.datasetCount
                                            @if(user.isDefined) {
                                                    <!-- If user can delete, the button is enabled, otherwise the button is present but disabled to provide consistent UE. -->
                                                @if( user.get.identityId.userId.equals(collection.author.identityId.userId)){
                                                    <button onclick="removeCollectionAndRedirect('@(collection.id)','@(routes.Collections.list(""))')" class="btn btn-link" style="text-align:right" title="Detach Delete the Collection">
                                                        <span class="glyphicon glyphicon-trash"></span></button>
                                                } else {
                                                    <button disabled onclick="removeCollectionAndRedirect('@(collection.id)','@(routes.Collections.list(""))')" class="btn btn-link" style="text-align:right" title="Detach Delete the Collection">
                                                        <span class="glyphicon glyphicon-trash"></span></button>
                                                }
                                            }
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6 col-lg-6 col-sm-6">
                                    <ul class="list-unstyled">
                                        <li>@if(user.isDefined && !collection.spaces.isEmpty){
                                            <div id="collection-users">
                                                <a href="@routes.Collections.users(collection.id)" class="btn btn-link ">
                                                    <span class="glyphicon glyphicon-hand-right"></span> Users with access to the collection
                                                </a>
                                                <div class="alert-danger inner-item">
                                                @flash.get("error")
                                                </div>
                                            </div>
                                        }</li>
                                        <li>
                                        @if(user.isDefined) {
                                            @if(!collection.followers.contains(user.get.id)) {
                                                <button id="followButton"
                                                class="btn btn-link"
                                                objectId="@collection.id"
                                                objectName="@collection.name"
                                                objectType="collection">
                                                    <span class='glyphicon glyphicon-star'></span> Follow
                                                </button>
                                            } else {
                                                <button id="followButton"
                                                class="btn btn-link"
                                                objectId="@collection.id"
                                                objectName="@collection.name"
                                                objectType="collection">
                                                    <span class='glyphicon glyphicon-star-empty'></span> Unfollow
                                                </button>
                                            }
                                        }
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <ul class="pager">
                @if(prev >=0) {
                    <li class="previous"><a id="prevlink" title="Page backwards" href="#">Previous</a></li>
                }
                @if(next >=0) {
                    <li class ="next"><a id="nextlink" title="Page forwards" href="#">Next</a></li>
                }
            </ul>
        </div>
    </div>

}
