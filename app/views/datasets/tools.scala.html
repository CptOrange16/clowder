@(sessions: List[UUID], sessionMap: scala.collection.mutable.Map[UUID, services.ToolSession], datasetId: UUID)(implicit user: Option[models.User])

@import api.Permission

<div class="row border-top bottom-padding">
  <div class="col-md-12">
    <h4>Tool sessions containing the dataset</h4>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div id="toolsList">
      @sessions.map { sessId =>
        <div id="col_@sessId" class="row bottom-padding">
          <div class="col-md-10">
            <div>
              @{
                var htmlStr = ""
                sessionMap.get(sessId) match {
                  case Some(ts) => {
                    if (ts.url == "") {
                      htmlStr += ts.name+" (not yet ready)</br>"
                      htmlStr += ts.id
                    }
                    else htmlStr += "<a href="+ts.url+" target='_blank'>"+ts.name+"</a>"

                    htmlStr += "</br>" //"<div>"
                    if (ts.attachedDatasets.keys.toList.length == 1) htmlStr += "1 dataset"
                    else htmlStr += ts.attachedDatasets.keys.toList.length.toString + " datasets"

                  }
                  case None => {}
                }
                Html(htmlStr)
              }
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>

<div class="row bottom-padding">
  <div class="col-md-12">
    <a class="btn btn-link" onclick="refreshToolSidebar()">
      <span class="glyphicon glyphicon-log-in"></span>&nbsp;Refresh List
    </a>
    <a class="btn btn-link" href="toolManager">
      <span class="glyphicon glyphicon-log-in"></span>&nbsp;Tool Manager
    </a>
  </div>

  <div class="col-md-12">
    <h4>Launch new tool session</h4>
    <div class="form-inline">
      <div class="input-group input-group-sm col-md-8">
        <input type="text" id="newToolNameField" class="form-control add-resource" placeholder="Enter session name">
        <select id="launchNewToolSession" class="form-control add-resource"></select>
        <span class="input-group-btn">
          <a href="#" onclick="launchToolRequest()" class="btn btn-default btn-large" id="launchtoolBtn" title="Launch New Tool Session">
            <span class="glyphicon glyphicon-plus"></span> New
          </a>
        </span>
      </div>
    </div>
  </div>

  <!--div class="col-md-12">
    <h4>Other tool sessions</h4>
    <div class="form-inline">
      <div class="input-group input-group-sm col-md-8">
        <select id="addToExistingToolSession" class="form-control add-resource">
        </select>
        <span class="input-group-btn">
          <a href="#" class="btn btn-default btn-large" id="addToolSessionBtn" title="Attach Dataset to Tool Session">
            <span class="glyphicon glyphicon-plus"></span> Add
          </a>
        </span>
      </div>
    </div>
  </div>
</div-->

<script language="javascript">
  $("#launchNewToolSession").select2({
    theme: "bootstrap",
    placeholder: "Select a new tool to launch",
    allowClear: true,
    ajax: {
      url: function() {
        return jsRoutes.controllers.Datasets.getLaunchableTools().url;
      },
      processResults: function(data, page) {
        var results = {
          results: data.map(function(x) {
            return {
              text: x,
              id: x
            }
          })};
        return results
      }
    }
  });

  $("#addToExistingToolSession").select2({
    theme: "bootstrap",
    placeholder: "Select a tool session",
    allowClear: true,
    ajax: {
      url: function(datasetId) {
        // GET LIST AND REMOVE ANY THE DATASET IS ALREADY ATTACHED TO
        return jsRoutes.controllers.Datasets.getUnattachedSessions("@datasetId").url;
      },
      processResults: function(data, page) {
        var outlist = []
        for (var sessId in data) {
          outlist.push({text: data[sessId], id: sessId.toString()})
        }
        return {results: outlist}
      }
    }
  });
</script>
