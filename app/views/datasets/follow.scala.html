@(dataset: Dataset)(implicit user: Option[models.User])

@if(user.isDefined) {
  @if(!dataset.followers.contains(user.get.id)) {
    <button id="followButton" class="btn-xs btn-success">Follow</button>
  } else {
    <button id="followButton" class="btn-xs btn-danger">Unfollow</button>
  }

    <div id="recommendDiv" class="row"
            style="display: none;
                    border: 1px solid #e3e3e3;
                    border-radius: 4px;
                    margin: 10px 5px;">
        <div>
            <div style="font-size: large; float: left;">You might want to follow these</div>
            <div style="float: right;">
                <a href="javascript:$('#recommendDiv').slideToggle('slow');">Close</a>
            </div>
        </div>
        <div style="clear: both;">
            <ul id="recommendList"></ul>
        </div>
    </div>

  <script>
    $("#followButton" ).on('click', function () {
        if ($(this ).text() === 'Follow') {
            var followRequest = jsRoutes.api.Datasets.follow('@dataset.id').ajax({
                type: 'POST'
            });

            followRequest.done(function (response, textStatus, jqXHR) {
                var $followButton = $('#followButton');
                $followButton.text('Unfollow');
                $followButton.removeClass('btn-success');
                $followButton.addClass('btn-danger');

                var $recommendDiv = $('#recommendDiv');
                if (!$recommendDiv.is(':visible')) {
                    var recommendList = response['recommendList'];
                    if (recommendList !== undefined && recommendList.length != 0) {
                        var $recommendList = $('#recommendList');
                        for (var i = 0; i < recommendList.length; i++) {
                            var recommendation = recommendList[i];
                            var id = recommendation['id'];
                            var name = recommendation['name'];
                            var objectType = recommendation['objectType'];

                            var route = '';
                            switch (objectType) {
                                case 'user':
                                    route = jsRoutes.controllers.Profile.viewProfileUUID(id);
                                    break;
                                case 'file':
                                    route = jsRoutes.controllers.Files.file(id);
                                    break;
                                case 'dataset':
                                    route = jsRoutes.controllers.Datasets.dataset(id);
                                    break;
                                case 'collection':
                                    route = jsRoutes.controllers.Collections.collection(id);
                                    break;
                            }
                            $recommendList.append('<li><a href="' + route.url + '">' +
                                name + '</a></li>'
                            );
                        }

                        $recommendDiv.slideToggle('slow');
                    }
                }
            });

            followRequest.fail(function (jqXHR, textStatus, errorThrown){
                console.error('Failed to follow!');
            });
        } else if ($(this ).text() === 'Unfollow') {
            var unfollowRequest = jsRoutes.api.Datasets.unfollow('@dataset.id').ajax({
                type: 'POST'
            });

            unfollowRequest.done(function (response, textStatus, jqXHR) {
                var $followButton = $('#followButton');
                $followButton.text('Follow');
                $followButton.removeClass('btn-danger');
                $followButton.addClass('btn-success');
            });

            unfollowRequest.fail(function (jqXHR, textStatus, errorThrown){
                console.error('Failed to unfollow!');
            });
        }
    });
  </script>
}

