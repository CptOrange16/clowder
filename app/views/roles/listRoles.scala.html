@(roles: List[Role], permissionList: List[api.Permission.Value])(implicit user: Option[models.User])

@main("Manage Roles") {
    <script src="@routes.Assets.at("javascripts/manageRoles.js")" type="text/javascript"></script>
    <script>
		function handleRemoval(roleid, theElement, url){
			var couldRemove = removeRole(roleid, url);
		}
	</script>
    <div class="page-header">
        <h1>Roles</h1>
    </div>
    <div class="row">
        <div class="col-md-12"><p>The list below shows all the roles available on the system.
            Roles are used to moderate access to spaces.
            Use the create new role button to create a new one.</p></div>
        <div class="col-md-12">
            @if(roles.isEmpty) {
                <div>No roles defined</div>
            }
            <div><a href="@routes.Admin.createRole()" class="btn btn-default">Create new role</a></div>
            @if(!roles.isEmpty) {
                <table class="table">
                    <thead><tr><th>Name</th><th>Description</th><th>Permissions</th><th>Edit / Delete</th></tr></thead>
                    @for(role <- roles) {
                        <tr><td>@role.name</td><td>@role.description</td><td id="permission">
                        @if(!role.permissions.isEmpty) {
                            <table class="table-progressive">
                                @for( p <- permissionList filter { role.permissions contains _.toString() } map { _.toString() } ) {
                                    <tr><td>
                                        @Html(p.replaceFirst("(\\p{Ll})(\\p{Lu})", "$1 $2").replaceFirst("(\\w) (.+)", "$1 <b>$2</b>").replaceAll("(\\p{Ll})(\\p{Lu})", "$1 $2"))
                                    </td></tr>
                                }
                            </table>
                        }
                        </td>
                        <td>
                            <a href="@routes.Admin.editRole(role.id)" class ="btn btn-link"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></a>
                            <button onclick="handleRemoval('@role.id',this, '@(routes.Admin.listRoles())')"
                            type="button" class="btn btn-link"><span class="glyphicon glyphicon-trash"/></button></td>
                        </tr>
                    }
                </table>
            }
        </div>
    </div>
}

