@(roles: List[Role])

@main("Manage Roles") {
    <script src="@routes.Assets.at("javascripts/manageRoles.js")" type="text/javascript"></script>
    <script>
		function handleRemoval(roleid, theElement, url){
			var couldRemove = removeRole(roleid, url);
		}
	</script>
    <div class="page-header">
        <h1>Roles</h1>
    </div>
    <div class="row">
        <div class="col-md-12"><p>The list below shows all the roles available on the system.
            Roles are used to moderate access to spaces.
            Use the create new role button to create a new one.</p></div>
        <div class="col-md-12">
            @if(roles.isEmpty) {
                <div>No roles defined</div>
            }
            <div><a href="@routes.Admin.createRole()" class="btn btn-default">Create new role</a></div>
            @if(!roles.isEmpty) {
                <table class="table">
                    <thead><tr><th>Name</th><th>Description</th><th>Permissions</th><th>Edit / Delete</th></tr></thead>
                    @for(role <- roles) {
                        <tr><td>@role.name</td><td>@role.description</td><td id="permission">

                        @for(permission <- role.permissions){
                            @permission.toString().replaceAll("(\\p{Ll})(\\p{Lu})","$1 $2"),
                            }
                        </td>
                        <td>
                            <a href="@routes.Admin.editRole(role.id)" class ="btn btn-link"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></a>
                            <button onclick="handleRemoval('@role.id',this, '@(routes.Admin.listRoles())')"
                            type="button" class="btn btn-link"><span class="glyphicon glyphicon-trash"/></button></td>
                        </tr>
                    }
                </table>
            }
        </div>
    </div>
    <script languate ="javascript">
        //Changes the id's in the permissions. And replaces the last ',' with a '.'
        var renumberpermission = function() {
        Array.prototype.reduce.call($('td#permission'), function(i, next) {
        var input = $(next);
        input.attr('id', input.attr('id')+ '_' + i + '_');
        var text = input.html();
        input.replaceWith(text.substring(0, text.lastIndexOf(',') - 1) + ".");
        if(input.attr('id').match(/permission_\d+|/)) {
        return i + 1;
        }
        return i;
        }, 0);
        }
        renumberpermission();
    </script>
}