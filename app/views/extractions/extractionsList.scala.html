@(extractions: Map[String, ExtractionGroup], extractType: String)
<div class="well">
    @if(extractions.size == 0) {
        <p>No extraction events recorded.</p>
    } else {
        <table class="table">
            <thead>
                <th></th>
                <th width="20%">Extractor</th>
                <th width="20%">Started</th>
                <th width="20%">Latest Update</th>
                <th width="40%">Latest Status</th>
            </thead>
            <tbody>
            @for((extractorName, group) <- extractions.toSeq.sortWith(_._2.latestMsgTime > _._2.latestMsgTime)) {
                <tr class="extractor-accordion-toggle clickable collapsed" data-toggle="collapse" data-target="#extractions-@extractorName.replace('.','-')">
                    <td>
                        <a class="btn btn-link">
                            @extractorName
                        </a>
                    </td>
                    <td>@group.firstMsgTime</td>
                    <td>@group.latestMsgTime</td>
                    <td>@group.latestMsg.replace("StatusMessage.start", "START").replace("StatusMessage.processing", "PROCESS").replace("StatusMessage.error", "ERROR")</td>

                </tr>
                <tr class="collapse" id="extractions-@extractorName.replace('.','-')">
                    <td colspan="5">
                        <table class="table table-condensed table-striped">
                            <thead>
                                <th></th>
                                <th>Last Update</th>
                                <th>Status</th>
                            </thead>
                            <tbody>
                            @for((job_id, eventList) <- group.allMsgs.toSeq.sortWith(_._1.stringify > _._1.stringify)) {
                                <tr class="job-list-accordion-toggle clickable collapsed" data-toggle="collapse" data-target="#extraction-job-@job_id">
                                    <td width="35%" title="@job_id"><a class="btn btn-link">@eventList.head.start</a></td>
                                    <td width="60%" class="accordion-status" style="vertical-align:middle;">@eventList.head.status</td>
                                </tr>
                                <tr class="collapse" id="extraction-job-@job_id">
                                    <td colspan="3" style="padding: 0 50px;">
                                        <table class="table table-hover">
                                            <thead>
                                                <th>Timestamp</th>
                                                <th>Status Message</th>
                                            </thead>
                                            <tbody>
                                            @for(evt <- group.allMsgs(job_id).reverse) {
                                                <tr>
                                                    <td width="40%"><b>@evt.start</b></td>
                                                    <td width="60%">
                                                        @evt.status.replace("StatusMessage.start", "START").replace("StatusMessage.processing", "PROCESS").replace("StatusMessage.error", "ERROR")
                                                        @if(evt.status == "SUBMITTED") {
                                                            <a class="btn btn-link btn-xs" id='@(evt.id)' onclick="cancelSubmission('@(evt.file_id)', '@(evt.id)', '@(evt.extractor_id)', '@(extractType)')">
                                                                Cancel
                                                            </a>
                                                        }
                                                    </td>
                                                </tr>

                                            }
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>


                            }
                            </tbody>
                        </table>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    }
</div>
<script type="text/javascript">
        function cancelSubmission(id, submit_id, extractor_id, extractType) {
            console.log("cancel submit: " + id + ", submit id: " + submit_id);
            var dataBody = {'extractor': extractor_id};
            var apicall = null

            if (extractType == "dataset") {// dataset submission
                apicall = jsRoutes.api.Extractions.cancelDatasetExtractionSubmission
            } else if(extractType == "file"){
                apicall = jsRoutes.api.Extractions.cancelFileExtractionSubmission
            }
            var request = apicall(id, submit_id).ajax({
                data: JSON.stringify(dataBody),
                type: 'POST',
                contentType: "application/json",
            });

            request.done(function (response, textStatus, jqXHR){
                notify("Cancellation request has been submitted", "success");
            });

            request.fail(function (jqXHR, textStatus, errorThrown){
                console.error("The following error occured: " + textStatus, errorThrown);
            });
        }
</script>
<style>
    .clickable {
        cursor: pointer;
    }
    .job-list-accordion-toggle:before, .extractor-accordion-toggle:before {
        /* symbol for "opening" panels */
        font-family: 'Glyphicons Halflings';  /* essential for enabling glyphicon */
        content: "\e114";    /* adjust as needed, taken from bootstrap.css */
        float: right;        /* adjust as needed */
        color: grey;         /* adjust as needed */
    }
    .job-list-accordion-toggle.collapsed:before, .extractor-accordion-toggle.collapsed:before {
        /* symbol for "collapsed" panels */
        content: "\e080";    /* adjust as needed, taken from bootstrap.css */
    }
    .job-list-accordion-toggle:before {
        padding: 14px 12px;
    }
    .extractor-accordion-toggle:before {
        padding: 16px 12px;
    }
    .job-list-accordion-status {
        padding: 12px 8px !important;
    }
</style>
