@(dataset: models.Dataset, previewers: Array[Previewer]) 

@main("Dataset") {

    <script src="@routes.Assets.at("javascripts/previews.js")" type="text/javascript"></script>
    
	<div class="page-header">
		<h1>@dataset.name</h1>
	</div>
	
	<div class="row-fluid">	
	
		<!-- left column -->
		<div class="span8">
		
		@dataset.files.map { f =>
			<div class="row-fluid">
		    	<div class="span12">
			  		<div class="tabbable">
						    @defining(for(p <- previewers ; pv <- f.previews) yield {
						    	if (p.contentType.contains(pv.contentType)) {
							    	(pv.id, p.id, p.path, p.main, api.routes.Previews.download(pv.id.toString) + "?key=letmein")
						    	} else if (p.contentType.contains(f.contentType)) {
					    			(f.id, p.id, p.path, p.main, routes.Files.file(f.id.toString) + "/blob")
						    	} else {
						    		("", "", "", "", "")
						    	}
						    }) { tabs =>
								<ul class="nav nav-pills" id="myTab">
					    		@for(tab <- tabs) {
					    			@if(tab._1 != "") {
							    		<li class=""><a href="#previewer_@tab._1" data-toggle="tab">@tab._2</a></li>
					    			}
						    	}
								</ul>
								<div class="tab-content">
						    		@for(tab <- tabs) {
						    			@if(tab._1 != "") {
									  		<div class="tab-pane" id="previewer_@tab._1"></div>
					    					<script>
												var Configuration = {};
												Configuration.tab = "#previewer_@tab._1"
												Configuration.id  = "@dataset.id";
												Configuration.url = "@tab._5";
											</script>
											<script type="text/javascript" src="@(routes.Assets.at(tab._3) + "/" + tab._4)"></script>
										}
   								    }
						  			<script type="text/javascript">
										$(function () {
						    				$('#myTab a:first').tab('show');
						 				 })
									</script>
								</div>
						    }
					</div>
		  		</div>
			</div>
			@if(f.sections.size > 0) {	
			  	<div class="row-fluid" style="padding: 10px">
			  	  <div class="span6">
				  	<div id="galleria" style="float:left;clear:none;width:300px;height:300px;">
					  	@f.sections.map { s =>
					  		@if(s.preview.isDefined) {
					  		<img src="@api.routes.Previews.download(s.preview.get.id.toString)?key=letmein" 
					  		class="img-polaroid" height="100px" data-title="Shot" data-description="Starts at @s.startTime seconds."></img>
					  		}
					  	}
				  	</div>
				  </div>
				  <div class="span6" style="padding: 5px">
				  	<div>
				  		<h5>Shots</h5>
						<table class="table">
							<thead>
								<tr>
									<th>#</th>
									<th>Start Time (sec)</th>
									<th>Find</th>
								</tr>
							</thead>
							<tbody>
					  		@f.sections.map { s =>
					  			<tr>
						  			<td>@s.order</td>
						  			 <td>@s.startTime</td>
						  			 <td><a href="@routes.Search.searchMultimediaIndex(s.id.toString)">Similar</a></td>
					  			 </tr>
					  		}
				  		</table>
				  	</div>
				  </div>
			  	</div>
			  			
				<script src="http://popcornjs.org/code/dist/popcorn-complete.min.js" type="text/javascript"></script>	
			    <script src="@routes.Assets.at("javascripts/galleria-1.2.9.js")" type="text/javascript"></script>
			    <script>
			    	$(function() {
					    // Load the classic theme
					    Galleria.loadTheme('@routes.Assets.at("javascripts/galleria-classic/galleria.classic.min.js")');
					
					    // Initialize Galleria
					    Galleria.run('#galleria');
					    
					    var gallery = $('#galleria').data('galleria');
					    
						Galleria.ready(function(options) {
						
						    // 'this' is the gallery instance
						    // 'options' is the gallery options
						
						    this.bind('image', function(e) {
						        Galleria.log('Now viewing ' + e.imageTarget.src);
						    });
						});
				      	
				      	
				    });
			    </script>
    			}
    		}
		</div>
		
		<!-- right column -->
		<div class="span4">
		    <div class="row">
				<dl>
					<dt>Description:</dt>
					<dd>@dataset.description</dd>
				    <dt>Created:</dt>
					<dd>@dataset.created</dd>
				</dl>
			</div>
			
			<div class="row">
				<h5>Files</h5>
				@dataset.files.map { file =>
				<div><a href="@(routes.Files.file(file.id.toString))" title="@file.contentType">@file.filename</a></div>
				}
			</div>
			
			<div class="row">
				<h5>Tags</h5>
				<ul id="tagList">
					@dataset.tags.map { tag =>
					  <li><a href="@routes.Tags.search(tag)">@tag</a></li>
					}
				</ul>
				<form class="form-inline">
					<input type="text" placeholder="Text input" id="tagField">
					<button class="btn" id="tagB">Tag</button>
				</form>
				<script language="javascript">
				$(function() {
					
				   $('#tagB').click(function() {
				     var tag = $('#tagField').val();

				     if (tag !== "") {
				     	 console.log("submitting tag " + tag);
					     var request = jsRoutes.controllers.Tags.tag().ajax({
					       data: JSON.stringify({"id":"@dataset.id","tag":tag}),
					       type: 'POST',
					       contentType: "application/json",
					     });
					     
					     request.done(function (response, textStatus, jqXHR){
					        console.log("Response " + response);
					        var url = "../tags/search/" + tag;
					        $('#tagList').append("<li><a href='" + url + "'>" + tag + "</a></li>");
					        $('#tagField').val("");
					     });
			    
					     request.fail(function (jqXHR, textStatus, errorThrown){
					        console.error(
					            "The following error occured: "+
					            textStatus, errorThrown
					            
					        );
					        window.location = "../login"; // FIXME hardcoded
					     });
				     }
				  });
				  
				  	$('#tagField').keypress(function (e) {
					  if (e.which == 13) {
					    console.log("enter");
					    $('#tagB').click();
					    
					  }
					});
				  
				 });
			     </script>
			</div>
		</div>
	</div>
}
